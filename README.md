# uav-airvision

## О проекте

UAV AirVision — это высокоточный модуль визуально-инерциальной одометрии (VIO) для беспилотных летательных аппаратов (БПЛА).  
Проект предназначен для оценки траектории движения с использованием стереокамер и IMU.  
Реализована архитектура с применением MSCKF (Multi-State Constraint Kalman Filter) для слияния визуальных и инерциальных данных.

---

## Особенности

- Обработка и синхронизация данных IMU и стереокамер
- Оптический трекинг признаков с использованием LK-оптического потока
- Стерео соответствия и фильтрация на основе эпиполярных ограничений и RANSAC
- Инициализация и оптимизация 3D положения признаков с учетом малых углов
- Калмановская фильтрация MSCKF с поддержкой буфера состояний камеры
- Асинхронная обработка данных с использованием многопоточности
- Визуализация результата с 3D графикой и выводом текущих изображений
- Конфигурация под EuRoC MAV с готовыми параметрами камер и IMU
- Поддержка запуска экспериментов с автоматическим перебором параметров сдвига времени

---

## Структура репозитория

├── config.py # Конфигурации параметров камеры, IMU и фильтра
├── dataset.py # Загрузка и предобработка датасета EuRoC MAV
├── publisher.py # Публикация потоков данных (IMU, стерео)
├── pipeline.py # Основной пайплайн обработки изображений и признаков
├── feature_* # Классы и модули для работы с признаками (трекер, инициализатор, аддер, прайнер, паблишер)
├── imu_processor.py # Обработка и интеграция данных IMU
├── camera_model.py # Модель камеры, дисторсия и коррекция точек
├── stereo_matcher.py # Модуль сопоставления стерео точек с фильтрацией
├── utils.py # Вспомогательные функции (кватернионы, матрицы вращения и др.)
├── modules/
│ └── vio.py # Класс VIO с потоковой обработкой IMU и изображений
├── viewer.py # Визуализация с PyQt и pyqtgraph 3D
├── main.py # Точка входа, запуск эксперимента с параметрами
├── run.bat # Скрипт запуска экспериментов с перебором датасетов и оффсетов
├── requirements.txt # Зависимости проекта
├── README.md 
└── results/ # Папка с результатами и логами


## Требования

- Python 3.10+
- OpenCV (cv2)
- NumPy
- PyQt5
- pyqtgraph
- SciPy

## Установка зависимостей:

```bash
pip install -r requirements.txt
Быстрый старт
Скачайте и распакуйте датасет EuRoC MAV (официальный сайт)

Укажите путь к датасету в параметре --path при запуске.

Запустите скрипт:

```bash
python main.py --path ./datasets/MH_01_easy --offset 10 --view
--offset — сдвиг времени (сек) для синхронизации данных IMU и камеры

--view — если задан, открывается визуализатор с 3D траекторией и изображениями
```

Результаты работы (траектория и состояние) сохраняются в папку results/txts/ с именами output_<dataset>_offset<offset>.txt

### Архитектура
DataPublisher — публикует сообщения из датасета асинхронно в очереди

VIO — обрабатывает IMU и изображения в отдельных потоках, вычисляет позицию с помощью MSCKF

ImageProcessingPipeline — построение пирамид изображений, трекинг, инициализация и добавление признаков, фильтрация

MSCKF — фильтр Калмана с расширенным состоянием, обновляющий ориентацию, позицию и смещения IMU и камер

Viewer — визуализация результатов в реальном времени

### Основные параметры конфигурации
Настраиваются в config.py в классе ConfigEuRoC:

Параметры камеры (intrinsics, distortion, extrinsics)

Параметры фильтра (шум, пороги, максимальное количество состояний камеры)

Параметры трекинга (порог RANSAC, параметры LK, сетка для распределения признаков)

### Примечания

Для запуска необходимы данные EuRoC MAV в оригинальном формате.

Скрипт run.bat позволяет запускать серию экспериментов с разными оффсетами.
